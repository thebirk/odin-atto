                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    import "utf8.odin";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Buffer :: struct {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        data: []rune;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        pre, post: u64;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf8_string: string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf32_string: []rune;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf8_dirty: bool;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf32_dirty: bool;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        name: ^string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        next, prev: ^Buffer;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_init :: proc(using buffer: ^Buffer, cap: int) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        data = make([]rune, cap);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        pre = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        post = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_insert(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move(buffer, 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_set_dirty(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_set_dirty :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf8_dirty = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        utf32_dirty = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_to_utf32_array :: proc(using buffer: ^Buffer) -> []rune {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if utf32_dirty {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //new_str: [dynamic]rune;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            new_str := make([]rune, pre+post);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in 0..pre {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //append(&new_str, data[i]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                new_str[i] = data[i];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in (cast(u64)cap(data))-post..(cast(u64)cap(data)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                append(&new_str, data[i]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }*/
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in 0..post {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                new_str[pre+post - i - 1] = data[cast(u64)cap(data) - i - 1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            free(utf32_string);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //utf32_string = cast([]rune)new_str[..];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            utf32_string = new_str;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            utf32_dirty = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return utf32_string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return utf32_string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_stringify :: proc(using buffer: ^Buffer) -> string {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if utf8_dirty {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            new_str: [dynamic]u8;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            offset := pre;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in 0..pre {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                buff, len := utf8.encode_rune(data[i]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for j in 0..len {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    append(&new_str, buff[j]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in (cast(u64)cap(data))-post..(cast(u64)cap(data)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                buff, len := utf8.encode_rune(data[i]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for j in 0..len {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    append(&new_str, buff[j]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            free(utf8_string);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            utf8_string = cast(string)new_str[..];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            utf8_dirty = false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return utf8_string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return utf8_string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    _buffer_expand :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        size := pre + post;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        old_size := cast(u64)len(data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if size != old_size {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        new_size := cast(u64)len(data)*2;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        new_data := make([]rune, cast(int)new_size);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for i in 0..pre {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            new_data[i] = data[i];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for i in 0..post {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            new_data[new_size - i - 1] = data[old_size - i - 1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        free(data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        data = new_data;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_set_dirty(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_get_pos :: proc(using buffer: ^Buffer) -> int {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return cast(int)buffer.pre;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_move :: proc(using buffer: ^Buffer, pos: int) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_cursor(buffer, pos - cast(int)pre);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_cursor :: proc(using buffer: ^Buffer, dist: int) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if dist == 0 do return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if dist > 0 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in 0..dist {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                buffer_move_right(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            dist = -dist;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in 0..dist {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                buffer_move_left(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_char_left :: proc(using buffer: ^Buffer, c: rune, first: bool = true) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if pre == 0 do return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if !first && data[pre] == c {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move_left(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_left(buffer, c, false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_char_right :: proc(using buffer: ^Buffer, c: rune, first: bool = true) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if post <= 1 do return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if !first && data[cast(u64)cap(data)-post] == c {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move_right(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_right(buffer, c, false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_home :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move_left(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if pre == 0 do return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if data[pre] == '\n' {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_move_right(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_home(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_end :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if post <= 1 do return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if data[cast(u64)cap(data)-post] == '\n' {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move_right(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_end(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_down :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Find current line start
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        start := buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_left(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        line_offset := start - buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Find end of current line
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_right(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Find length of this line
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_right(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        length := buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_left(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        length -= buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if line_offset <= length {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_seek_cursor(buffer, line_offset);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_seek_cursor(buffer, length);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // TODO: Add a buffer.seek_offset variable. Use this instead of line_offset
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //       update seek_offset when seeking, and here. Also seek_end should set a 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //       seek offset like -1 which will always look for the end of the line
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_seek_up :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Get current offset
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        pos := buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_left(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        old_start := buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        line_offset := pos - old_start;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Move to the previous newline, calc length of that line, check if we fit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_seek_char_left(buffer, '\n');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        length := old_start - buffer_get_pos(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if line_offset <= length {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_seek_cursor(buffer, line_offset);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_seek_cursor(buffer, length);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_get_linecount :: proc(using buffer: ^Buffer) -> int {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        str_date := buffer_to_utf32_array(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        length := 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for r in str_date {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if r == '\n' do length += 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return length;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_insert :: proc(using buffer: ^Buffer, r: rune) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        _buffer_expand(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        data[pre] = r;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        pre += 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_set_dirty(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_insert :: proc(using buffer: ^Buffer, s: string) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for r in s {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_insert(buffer, r);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_backspace :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        _buffer_expand(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if pre > 0 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            pre -= 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buffer_set_dirty(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_delete :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_move_right(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        buffer_backspace(buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_move_left :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if(pre > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            r := data[pre - 1];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            data[cast(u64)cap(data) - post - 1] = r;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            post += 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            pre -= 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer_move_right :: proc(using buffer: ^Buffer) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if(post > 1) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            data[pre] = data[cast(u64)cap(data) - post];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            pre += 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            post -= 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
}